# テストガイド

このドキュメントでは、Tech Blogの機能テスト、パフォーマンステスト、アクセシビリティ検証の手順を説明します。

## 📋 テスト前の準備

### 環境構築

```bash
# 依存関係のインストール
pnpm install

# ビルド実行
pnpm build

# Pagefindインデックス生成
npx pagefind --site dist

# プレビューサーバー起動
pnpm preview
```

プレビューサーバーは `http://localhost:4321` で起動します。

## ✅ 機能テスト (Task 15.1)

### 1. ホームページの確認

**テスト項目:**
- [ ] ホームページ (`/`) が正しく表示される
- [ ] 記事一覧が新しい順にソートされている
- [ ] 各記事カードにタイトル、投稿日、タグ、概要が表示される
- [ ] ページネーション（11件以上の記事がある場合）が動作する

**手順:**
1. `http://localhost:4321` にアクセス
2. 記事一覧の表示を確認
3. 記事の投稿日が降順になっているか確認
4. 記事カードの情報が完全か確認

### 2. 記事詳細ページの確認

**テスト項目:**
- [ ] 記事詳細ページが正しく表示される
- [ ] 記事タイトル（h1）、投稿日、タグが表示される
- [ ] Markdown本文が正しくHTMLレンダリングされる
- [ ] 目次が自動生成される（h2/h3見出しから）
- [ ] コードブロックがシンタックスハイライトされる
- [ ] コピーボタンが動作する
- [ ] 記事下部に広告スロットが表示される（広告有効時）

**手順:**
1. ホームページから任意の記事をクリック
2. `/posts/[slug]` ページに遷移することを確認
3. 記事の各要素が正しく表示されるか確認
4. 目次のリンクをクリックして該当見出しにジャンプすることを確認
5. コードブロックのコピーボタンをクリックしてクリップボードにコピーされることを確認

### 3. タグ機能の確認

**テスト項目:**
- [ ] タグ一覧ページ (`/tags`) が正しく表示される
- [ ] すべてのタグが投稿数付きで表示される
- [ ] タグをクリックすると該当記事一覧に遷移する
- [ ] タグ別記事一覧ページ (`/tags/[tag]`) が正しく表示される
- [ ] ページネーション（11件以上の場合）が動作する

**手順:**
1. ヘッダーの「タグ一覧」をクリック
2. タグ一覧ページが表示されることを確認
3. 各タグの投稿数が正しいか確認
4. 任意のタグをクリック
5. 該当タグの記事のみが表示されることを確認

### 4. 全文検索機能の確認

**テスト項目:**
- [ ] 検索ページ (`/search`) が正しく表示される
- [ ] Pagefind UIが読み込まれる
- [ ] キーワード検索が動作する
- [ ] 検索結果にタイトル、スニペット、ハイライトが表示される
- [ ] 日本語検索が正しく動作する
- [ ] 検索結果0件時のメッセージが表示される

**手順:**
1. ヘッダーの検索アイコンをクリック
2. 検索ページが表示されることを確認
3. 検索ボックスにキーワード（例: "Astro"）を入力
4. 検索結果が表示されることを確認
5. マッチ箇所がハイライトされていることを確認
6. 存在しないキーワードで検索し、0件メッセージを確認

### 5. テーマ切り替え機能の確認

**テスト項目:**
- [ ] テーマトグルボタンが表示される
- [ ] ライトモード/ダークモードの切り替えが動作する
- [ ] 選択したテーマがlocalStorageに保存される
- [ ] ページリロード後もテーマが保持される
- [ ] システム設定がデフォルトとして機能する

**手順:**
1. ヘッダーのテーマトグルボタンをクリック
2. テーマが切り替わることを確認
3. 各ページでテーマが一貫して適用されることを確認
4. ページをリロードしてテーマが保持されることを確認
5. localStorageの `theme` キーを削除してシステム設定に戻ることを確認

### 6. Aboutページの確認

**テスト項目:**
- [ ] Aboutページ (`/about`) が正しく表示される
- [ ] ブログの目的と方針が表示される
- [ ] 管理者プロフィールが表示される
- [ ] Markdownが正しくレンダリングされる

**手順:**
1. ヘッダーの「About」をクリック
2. Aboutページが表示されることを確認
3. 各セクションが正しく表示されることを確認

### 7. レスポンシブデザインの確認

**テスト項目:**
- [ ] モバイル（< 640px）で正しく表示される
- [ ] タブレット（640px - 1024px）で正しく表示される
- [ ] デスクトップ（> 1024px）で正しく表示される
- [ ] モバイルでハンバーガーメニューが表示される
- [ ] デスクトップで水平メニューが表示される

**手順:**
1. ブラウザの開発者ツールを開く
2. デバイスモードに切り替え
3. 各デバイスサイズ（iPhone SE, iPad, Desktop）で表示を確認
4. レイアウトが崩れていないか確認
5. モバイルメニューの開閉を確認

## 🚀 パフォーマンステスト (Task 15.2)

### 1. Lighthouse監査

**目標スコア:**
- Performance: 95点以上
- Accessibility: 95点以上
- Best Practices: 95点以上
- SEO: 95点以上

**手順:**

#### Chrome DevTools での実行

1. Chrome DevToolsを開く（F12）
2. Lighthouseタブを選択
3. カテゴリをすべて選択
4. モードを「Navigation」に設定
5. 「Analyze page load」をクリック

#### Lighthouse CLI での実行

```bash
# Lighthouse CLIのインストール
pnpm add -g lighthouse

# デスクトップ監査
lighthouse http://localhost:4321 --preset=desktop --view

# モバイル監査
lighthouse http://localhost:4321 --preset=mobile --view

# 複数ページの監査
lighthouse http://localhost:4321 --view
lighthouse http://localhost:4321/about --view
lighthouse http://localhost:4321/posts/2025-01-15-astro-blog-tutorial --view
```

### 2. Core Web Vitals 確認

**目標値:**
- LCP (Largest Contentful Paint): < 2.5s
- FID (First Input Delay): < 100ms
- CLS (Cumulative Layout Shift): < 0.1

**手順:**

1. Chrome DevToolsの「Performance」タブを開く
2. 「Record」ボタンをクリック
3. ページをリロード
4. 「Stop」をクリック
5. 「Web Vitals」レーンでメトリクスを確認

または、Lighthouse結果の「Metrics」セクションで確認。

### 3. バンドルサイズ確認

**目標:**
- 合計バンドルサイズ（gzip圧縮後）: < 100KB

**手順:**

```bash
# ビルド実行
pnpm build

# バンドルサイズを確認（出力に表示される）
# 出力例:
# dist/_astro/search.js   1.10 kB (gzip)
# dist/_astro/ui-core.js  22.86 kB (gzip)
# 合計: ~24KB
```

### 4. ビルド時間テスト（100記事）

**目標:**
- 100記事でのビルド時間: < 1分

**手順:**

```bash
# 記事を追加（100件まで）
# src/content/blog/ に記事ファイルを追加

# ビルド時間計測
time pnpm build

# 出力例:
# real    0m45.234s
# user    0m42.156s
# sys     0m3.078s
```

**注:** 現在3記事で約2.2秒のため、100記事では推定73秒（1分13秒）程度。

## ♿️ アクセシビリティ検証 (Task 15.3)

### 1. WCAG AA 準拠確認

**テスト項目:**
- [ ] コントラスト比が4.5:1以上（通常テキスト）
- [ ] コントラスト比が3:1以上（大きなテキスト）
- [ ] すべてのインタラクティブ要素にアクセス可能
- [ ] フォーカスインジケーターが明示的
- [ ] セマンティックHTMLが使用されている

**手順:**

#### axe DevTools での確認

1. [axe DevTools](https://www.deque.com/axe/devtools/) をインストール
2. ブラウザでページを開く
3. axe DevToolsを起動
4. 「Scan」をクリック
5. 検出された問題を確認・修正

#### WAVE での確認

1. [WAVE Extension](https://wave.webaim.org/extension/) をインストール
2. ページでWAVEを起動
3. エラー、警告、アラートを確認

### 2. キーボードナビゲーション確認

**テスト項目:**
- [ ] Tabキーですべてのリンク・ボタンにフォーカス可能
- [ ] Enterキーでリンク・ボタンを実行可能
- [ ] Spaceキーでボタンを実行可能
- [ ] フォーカス順序が論理的
- [ ] フォーカスインジケーターが常に表示される

**手順:**

1. マウスを使わずにTabキーでページ内を移動
2. すべてのインタラクティブ要素にフォーカスできることを確認
3. Enter/Spaceキーで操作できることを確認
4. フォーカスが見やすいことを確認（2pxアウトライン）
5. モバイルメニューの開閉をキーボードで操作

### 3. スクリーンリーダー対応確認

**テスト項目:**
- [ ] 適切なARIAラベルが設定されている
- [ ] ランドマークロール（nav, main, footer）が使用されている
- [ ] 画像に代替テキストがある
- [ ] フォーム要素にラベルがある
- [ ] 動的コンテンツの変更が通知される

**手順:**

#### macOS VoiceOver での確認

```bash
# VoiceOverを起動（Cmd + F5）
# VO = Control + Option

# 基本操作:
# VO + → : 次の要素へ
# VO + ← : 前の要素へ
# VO + Space : 実行
# VO + U : ローター（見出し、リンク、フォーム一覧）
```

1. VoiceOverを起動
2. ページ内を移動し、読み上げ内容を確認
3. 見出し構造を確認（VO + U → 見出し）
4. リンクテキストが明確か確認
5. 画像の代替テキストが適切か確認

#### NVDA (Windows) での確認

```
# NVDAを起動（Ctrl + Alt + N）

# 基本操作:
# ↓ : 次の行
# H : 次の見出し
# K : 次のリンク
# Insert + F7 : 要素一覧
```

1. NVDAを起動
2. ページを読み上げさせる
3. 見出しジャンプ（H）で構造を確認
4. リンクジャンプ（K）でリンクテキストを確認

### 4. カラーコントラスト確認

**手順:**

#### Chrome DevTools での確認

1. 要素を検査
2. Stylesパネルでcolor値にカーソルを合わせる
3. コントラスト比が表示される
4. WCAG AAの基準（4.5:1）を満たすか確認

#### Contrast Checker での確認

1. [WebAIM Contrast Checker](https://webaim.org/resources/contrastchecker/) にアクセス
2. 前景色と背景色を入力
3. コントラスト比を確認
4. WCAG AAに適合するか確認

**現在のカラー設定（確認済み）:**
- ライトモード: テキスト #1a202c / 背景 #ffffff（コントラスト比 16:1 ✅）
- ダークモード: テキスト #e2e8f0 / 背景 #1a202c（コントラスト比 12.6:1 ✅）
- アクセント: #3b82f6（ボタン、リンク）

## 📊 テスト結果の記録

### テストレポートテンプレート

```markdown
# テスト実施レポート

## 実施日
YYYY-MM-DD

## 実施者
Your Name

## テスト環境
- OS: macOS 14.0 / Windows 11
- Browser: Chrome 120 / Firefox 121 / Safari 17
- Node.js: 20.10.0
- デバイス: Desktop / Mobile (iPhone 14) / Tablet (iPad)

## 機能テスト結果

### ホームページ
- [x] 記事一覧表示: 正常
- [x] ソート順: 正常
- [ ] ページネーション: 未実施（記事数不足）

### 記事詳細
- [x] 記事表示: 正常
- [x] 目次生成: 正常
- [x] コードハイライト: 正常

（以下省略）

## パフォーマンステスト結果

### Lighthouse スコア
- Performance: 98
- Accessibility: 100
- Best Practices: 100
- SEO: 100

### Core Web Vitals
- LCP: 1.2s ✅
- FID: 5ms ✅
- CLS: 0.02 ✅

### バンドルサイズ
- 合計: 24KB (gzip) ✅

## アクセシビリティ検証結果

### axe DevTools
- エラー: 0件 ✅
- 警告: 0件 ✅

### キーボードナビゲーション
- Tab順序: 正常 ✅
- フォーカス表示: 正常 ✅

### スクリーンリーダー
- VoiceOver: 正常 ✅
- 見出し構造: 正常 ✅

## 問題点

なし

## 改善提案

なし

## 総合評価

全項目で基準をクリア。本番環境へのデプロイ準備完了。
```

## 🔄 継続的テスト

### 自動テストの設定

GitHub Actionsで自動テストを実行：

```yaml
# .github/workflows/ci.yml
# すでに設定済み
# - リント・型チェック
# - ビルドテスト
# - Lighthouse CI
# - 依存関係レビュー
```

### テスト頻度

- **機能テスト**: 新機能追加時、記事追加時
- **パフォーマンステスト**: 週次、大規模変更時
- **アクセシビリティ検証**: 月次、UI変更時

## 📚 参考リソース

- [Lighthouse ドキュメント](https://developer.chrome.com/docs/lighthouse)
- [Web Vitals](https://web.dev/vitals/)
- [WCAG 2.1 ガイドライン](https://www.w3.org/WAI/WCAG21/quickref/)
- [axe DevTools](https://www.deque.com/axe/devtools/)
- [WAVE](https://wave.webaim.org/)
- [VoiceOver ユーザーガイド](https://www.apple.com/voiceover/info/guide/)
- [NVDA ユーザーガイド](https://www.nvaccess.org/get-help/)
